<div class="calendar mt-8">
  {{ $events := where .Site.Data.calendar "start.dateTime" "!=" nil }}
  {{ $sorted := sort $events "start.dateTime" }}

  {{ .Scratch.Set "months" (dict) }}
  {{ range $sorted }}
    {{ $date := time .start.dateTime }}
    {{ $key := printf "%d-%02d" $date.Year $date.Month }}
    {{ $group := .Scratch.Get "months" }}
    {{ $current := index $group $key }}
    {{ if not $current }}{{ $current = slice }}{{ end }}
    {{ .Scratch.Set "months" (merge $group (dict $key (append $current .))) }}
  {{ end }}

  {{ $months := .Scratch.Get "months" }}
  {{ range $sorted }}
    {{ $date := time .start.dateTime }}
    {{ $key := printf "%d-%02d" $date.Year $date.Month }}
    {{ $group := index $months $key }}
    {{ if $group }}
      <h2 class="text-3xl font-bold mt-8 mb-4 text-gray-800">{{ $date.Month }} {{ $date.Year }}</h2>
      {{ .Scratch.Set "months" (merge $months (dict $key nil)) }}
      {{ range $group }}
        {{ $start := time .start.dateTime }}
        {{ $end := time .end.dateTime }}
        <div class="event mb-6 p-4 bg-gray-50 rounded-lg shadow-sm">
          <h3 class="text-2xl font-bold text-gray-800">{{ .summary }}</h3>
          <h4 class="text-lg text-gray-600 mt-2">
            {{ $start.Day }}/{{ $start.Month }}/{{ $start.Year }} • 
            {{ $start.Hour }}:{{ printf "%02d" $start.Minute }} – {{ $end.Hour }}:{{ printf "%02d" $end.Minute }}
          </h4>
          {{ with .location }}
            <p class="mt-1"><strong>Lieu :</strong> {{ . }}</p>
          {{ end }}
          {{ with .description }}
            <div class="mt-3 text-gray-700">{{ . | safeHTML }}</div>
          {{ end }}
          <a href="/contact/" class="mt-4 inline-block px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">
            Contact
          </a>
        </div>
      {{ end }}
    {{ end }}
  {{ end }}
</div>   