<div class="calendar-container">
  <div id="calendar"></div>
</div>

<div id="eventModal" class="fixed inset-0 z-50 hidden flex items-center justify-center" style="background-color: #000#FFF6E0;">
  <div class="bg-amber-100 dark:bg-gray-800 border-2 border-stone-900 border-stone-300 rounded-xl shadow-2xl p-6 m-4 max-w-lg w-full">
    <button type="button" class="float-right text-3xl font-bold cursor-pointer text-gray-600 dark:text-gray-300 close-modal">&times;</button>
    <h3 id="eventTitle" class="text-2xl font-semibold text-gray-800 dark:text-white"></h3>
    <p class="text-gray-700 dark:text-gray-300"><strong>Heure de début:</strong> <span id="eventStart"></span></p>
    <p class="text-gray-700 dark:text-gray-300"><strong>Heure de fin:</strong> <span id="eventEnd"></span></p>
    <p class="text-gray-700 dark:text-gray-300"><strong>Lieu:</strong> <span id="eventLocation"></span></p>
    <p class="text-gray-700 dark:text-gray-300"><strong>Description:</strong><br><span id="eventDescription"></span></p>
  </div>
</div>

<!-- Remove or comment out this line to apply Tailwind CSS -->
<!-- <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/index.css" rel="stylesheet"> -->

<script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/min/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-timezone@0.5.40/builds/moment-timezone-with-data.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/moment-timezone@6.1.20/index.global.min.js"></script>

<style>
  .calendar-container {
    @apply px-5 mt-5;
  }

  @media (max-width: 768px) {
    .calendar-container {
      @apply px-3 mt-3;
    }
  }
/* Styles FullCalendar avec variables (en dehors de @layer) */
.fc {
  --fc-border-color: #01290C;
  --fc-button-bg-color: #01290C;
  --fc-button-border-color: #01290C;
  --fc-button-hover-bg-color: #479963;
  --fc-button-active-bg-color: #007928;
  --fc-event-bg-color: #8d4e01;
  --fc-event-border-color: #57534e;
  --fc-today-bg-color: #FFF6E0;
}
.fc-list-event {
  --fc-list-event-bg-color: #007928;        
  --fc-list-event-text-color: #000000;      
  --fc-list-event-hover-bg-color: #DEDEAB;  
}

/* Dark Mode */
.dark .fc {
  --fc-border-color: #282828;
  --fc-button-bg-color: #3c3c3c;
  --fc-button-border-color: #323232;
  --fc-button-hover-bg-color: #505050;
  --fc-button-active-bg-color: #646464;
  --fc-event-bg-color: #464646;
  --fc-event-border-color: #464646;
  --fc-today-bg-color: #323232;
}

.dark .fc-list-event {
  --fc-list-event-bg-color: #000000;        
  --fc-list-event-text-color: #ffffff;      
  --fc-list-event-hover-bg-color: #000000;  
}
.dark .fc-list-day-cushion {
  --fc-list-day-cushion-bg: #000000;
  --fc-list-day-cushion-color: #000000; 
}

.fc-cell-shaded {
  --fc-cell-shaded-bg: #DEDEAB; /* Light theme */
  --fc-cell-shaded-color: #000;
}

.dark .fc-cell-shaded {
  --fc-cell-shaded-bg: #2d2d2d; /* Dark theme */
  --fc-cell-shaded-color: #fff;
}
.fc-list-day-cushion {
  --fc-list-day-cushion-bg: #007928;
  --fc-list-day-cushion-color: #000;
  padding: 10px;
  font-weight: bold; 
}
.fc-cell-shaded {
  background-color: var(--fc-cell-shaded-bg) !important;
  color: var(--fc-cell-shaded-color);
}

</style>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const calendarEl = document.getElementById('calendar');
    if (!calendarEl) {
      console.error('❌ #calendar element not found');
      return;
    }

    const isMobile = window.innerWidth < 768;
    const leftButtons = isMobile ? '' : 'dayGridMonth listMonth';
    const rightButtons = isMobile ? 'prev today next' : 'prev today next';

    try {
      const response = await fetch('/data/calendar.json');
      const events = await response.json();

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'listMonth',
        timeZone: 'Europe/Paris',
        locale: 'fr',
        listDayFormat: { weekday: 'long', day: 'numeric', month: 'long' },
        listDaySideFormat: false,
        buttonText: {
          today: 'o',
          list: 'Liste',
          dayGridMonth: 'Calendrier'
        },
        headerToolbar: {
          left: leftButtons,
          center: 'title',
          right: rightButtons
        },
        events: events,
        eventDidMount: function(info) {
          if (info.view.type === 'listMonth' && info.event.extendedProps.description) {
            const descEl = document.createElement('div');
            descEl.innerHTML = info.event.extendedProps.description;
            const titleLink = info.el.querySelector('.fc-list-event-title a');
            if (titleLink) {
              titleLink.appendChild(descEl);
            }
          }
        },
        eventClick: function(info) {
          info.jsEvent.preventDefault();

          document.getElementById('eventTitle').textContent = info.event.title;
          document.getElementById('eventStart').textContent = info.event.start?.toLocaleString() || 'N/A';
          document.getElementById('eventEnd').textContent = info.event.end?.toLocaleString() || 'N/A';

          const locEl = document.getElementById('eventLocation');
          if (info.event.extendedProps.location) {
            const encodedLoc = encodeURIComponent(info.event.extendedProps.location);
            locEl.innerHTML = `<a href="https://maps.google.com/?q=${encodedLoc}" target="_blank">${info.event.extendedProps.location}</a>`;
          } else {
            locEl.textContent = 'Pas de lieu';
          }

          const descEl = document.getElementById('eventDescription');
          if (info.event.extendedProps.description) {
            descEl.innerHTML = info.event.extendedProps.description;
          } else {
            descEl.textContent = 'Pas de description';
          }

          document.getElementById('eventModal').style.display = 'flex';
        }
      });

      calendar.render();
    } catch (err) {
      console.error('❌ Error loading calendar:', err);
    }

    document.querySelector('.close-modal')?.addEventListener('click', () => {
      document.getElementById('eventModal').style.display = 'none';
    });
    window.addEventListener('click', (e) => {
      if (e.target === document.getElementById('eventModal')) {
        document.getElementById('eventModal').style.display = 'none';
      }
    });
  });
</script> 