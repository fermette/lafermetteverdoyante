<div id="calendar"></div>
<div id="eventModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2 id="eventTitle"></h2>
    <p><strong>Start:</strong> <span id="eventStart"></span></p>
    <p><strong>End:</strong> <span id="eventEnd"></span></p>
    <p><strong>Location:</strong> <span id="eventLocation"></span></p>
    <p><strong>Description:</strong><br><span id="eventDescription"></span></p>
    <p><a id="eventLink" href="#" target="_blank">View on Google Calendar</a></p>
  </div>
</div>

<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/index.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/min/moment.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment-timezone@0.5.40/builds/moment-timezone-with-data.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.20/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/moment-timezone@6.1.20/index.global.min.js"></script>

<style>
  .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); }
  .modal-content { background: white; margin: 5% auto; padding: 20px; border: 1px solid #888; width: 80%; max-width: 600px; border-radius: 10px; }
  .close { float: right; font-size: 28px; font-weight: bold; cursor: pointer; }
</style>

<script>
  document.addEventListener('DOMContentLoaded', async () => {
    const calendarEl = document.getElementById('calendar');
    if (!calendarEl) {
      console.error('❌ #calendar element not found');
      return;
    }

    try {
      const response = await fetch('/data/calendar.json');
      const events = await response.json();

      const calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        timeZone: 'Europe/Paris',
        locale: 'en', // ✅ English locale
        events: events,
        eventClick: function(info) {
          info.jsEvent.preventDefault(); // ✅ Prevent Goggle Agenda redirect

          document.getElementById('eventTitle').textContent = info.event.title;
          document.getElementById('eventStart').textContent = info.event.start?.toLocaleString() || 'N/A';
          document.getElementById('eventEnd').textContent = info.event.end?.toLocaleString() || 'N/A';

          const locEl = document.getElementById('eventLocation');
          if (info.event.extendedProps.location) {
            const encodedLoc = encodeURIComponent(info.event.extendedProps.location);
            locEl.innerHTML = `<a href="https://maps.google.com/?q=${encodedLoc}" target="_blank">${info.event.extendedProps.location}</a>`;
          } else {
            locEl.textContent = 'No location';
          }

          document.getElementById('eventDescription').textContent = info.event.extendedProps.description || 'No description';

          const linkEl = document.getElementById('eventLink');
          if (info.event.url) {
            linkEl.href = info.event.url;
            linkEl.style.display = 'inline';
          } else {
            linkEl.style.display = 'none';
          }

          document.getElementById('eventModal').style.display = 'block';
        }
      });

      calendar.render();

      document.querySelector('.close')?.addEventListener('click', () => {
        document.getElementById('eventModal').style.display = 'none';
      });
      window.addEventListener('click', (e) => {
        if (e.target === document.getElementById('eventModal')) {
          document.getElementById('eventModal').style.display = 'none';
        }
      });
    } catch (err) {
      console.error('❌ Error loading calendar:', err);
    }
  });
</script> 